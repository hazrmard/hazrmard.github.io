<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/atom-one-dark.min.css">
            <script>hljs.initHighlightingOnLoad();</script>
        
        
    
    <link rel="stylesheet" type="text/css" href="/css/hugolb.css">
    <link rel="stylesheet" type="text/css" href="/css/cosmetic.css">
    <title>Optimizing static sites with hugo</title>
</head>
<body>
    <div class="container">

<div class="content">
    <h1 class="post-title">Optimizing static sites with hugo</h1>
    <div class="front-matter">
    
        <em>Monday, Feb 6, 2017</em>
    
    
        
            
                <br/>Categories:
                    
                        <a href="/categories/developer">Developer</a>,
                    
                        <a href="/categories/meta">Meta</a>,
                    
            
        
    
        
            
        
    
        
            
                <br/>Tags:
                    
                        <a href="/tags/javascript">Javascript</a>,
                    
                        <a href="/tags/hugo">Hugo</a>,
                    
                        <a href="/tags/web-development">Web development</a>,
                    
            
        
    
</div>

    
    <p>According to <a href="http://httparchive.org/trends.php">httparchive</a> the average size
of a web page in 2016 was around 2.5MB. Now this may not seem a lot in this age
where the internet is the primary media delivery platform - but it is worth
noting that most web pages serve text as their primary content. Looking at the
report sheds light on what constitutes an average web page:</p>

<p>The HTML content takes up around 50-60kB. Images, understandably, make up the
biggest chunk with ~1.6MB. Around another ~200kB are taken up by CSS and Font
files. What is surprising to me is that the next biggest chunk, at above 400kB,
is JavaScript.</p>

<figure>
    <img src="/img/posts/optimizing-static-sites-with-hugo/chart.png">
</figure>

<p>The portion I want to go after is <code>JavaScript</code>. Granted that JavaScript is
indispensable to web development. However in excess it can weigh everything
down. Particularly in cases when it - instead of <code>CSS</code> -  is used to add
responsivity to a website. In my experience <code>jQuery</code> is the biggest culprit
of unnecessary bloat. But I digress.</p>

<p>While I was building this website using <a href="https://gohugo.io">Hugo</a> I realized
that I would need additional JavaScript libraries for highlighting code and
rendering math. And these libraries take up a ton of space. This:</p>

<ul>
<li>Increases the bandwidth cost for the user, and</li>
<li>Increases loading times which make browsing experience clunky.</li>
</ul>

<figure>
    <img src="/img/posts/optimizing-static-sites-with-hugo/network_stats.png">
    <figcaption>An overview of network traffic for a webpage on this site using
        MathJax library</figcaption>
</figure>

<p>Above is network traffic for a page on this site that uses 3rd party JS libraries
to render equations. Around 200/218kB of network traffic is for that one library.
This may seem a trivial amount of data but I believe that any optimization is
good optimization (<em>in production especially</em>). So I harnessed all the flexibility
a static site can offer. When I now build my site, only pages that render
equations or contain code request external libraries. Thus different pages on my
site have different - but the leanest possible - network traffic signatures.</p>

<p>How did I do it? When building sites using Hugo, for each post I can define
variables that Hugo can use while rendering a page template into HTML. These
variables are called <em>front matter</em> in Hugo-speak. For example, <em>front matter</em>
for this page looks like:</p>

<pre><code class="language-toml">+++
categories = [&quot;Developer&quot;, &quot;Meta&quot;]
date = &quot;2017-02-03T10:07:58-06:00&quot;
hasequations = false
title = &quot;Optimizing static sites with hugo&quot;
hascode = true
isexternal = false
series = []
description = &quot;&quot;
tags = [&quot;Javascript&quot;, &quot;Hugo&quot;]
draft = true
+++
</code></pre>

<p>And the <code>&lt;head&gt;</code> section for the HTML template looks like this:</p>

<pre><code class="language-HTML">{{if .IsPage}}
    {{if .Params.hascode}}
        &lt;script src=&quot;https://V_V_LONG_PATH_TO_LIBRARY/highlight.min.js&quot;&gt;&lt;/script&gt;
        &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://EVEN_LONGER_PATH.min.css&quot;&gt;
        &lt;script&gt;hljs.initHighlightingOnLoad();&lt;/script&gt;
    {{end}}
    {{if .Params.hasequations}}
        &lt;script type=&quot;text/javascript&quot; async
            src=&quot;https://DECENT_LENGTH_PATH/MathJax.js?config=TeX-AMS_CHTML&quot;&gt;
        &lt;/script&gt;
    {{end}}
{{end}}
</code></pre>

<p>So now, only when I set <code>hasequations</code> to <code>true</code> does the page load
<a href="https://www.mathjax.org/"><code>MathJax</code></a>. Same with <code>hascode</code> and
<a href="https://highlightjs.org/"><code>Highlight.js</code></a>. This speeds up my load times and
frees up the generous CDNs from unnecessary traffic. All it took was a few lines.
Win-Win.</p>

    <br/>
    <div class="navigation">
    
        <a href="http://iahmed.me/post/is-cold-the-new-hot/"><div class="prev">
            ← Previous Post
        </div></a>
    
    
        <a href="http://iahmed.me/post/algorithms-balancing/"><div class="next">
            Next Post →
        </div></a>
    
</div>

</div>
<div class="sidebar">
    <div class="menu-icon"><h2>≡</h2></div>
    <div class="title"><h1 class="site-name">Ibrahim Ahmed</h1>
        
            <div class="sb-links">
                
                    <a href="https://www.linkedin.com/in/IbrahimAhmed1"><img src="/img/LinkIcons/svg/linkedin.svg"/></a>
                
                    <a href="https://github.com/hazrmard"><img src="/img/LinkIcons/svg/github.svg"/></a>
                
                    <a href="http://stackoverflow.com/users/4591810/hazrmard"><img src="/img/LinkIcons/svg/stackoverflow.svg"/></a>
                
            </div>
        
    </div>
    <ul class="menu-list">
        
            <a href="/">
            <li class="sb-option ">
                
                    <img src="/img/LinkIcons/svg/home.svg" alt="Home"/><span class="menu-option-name">Home</span>
                
                
            </li></a>
        
            <a href="/about/">
            <li class="sb-option ">
                
                    <img src="/img/LinkIcons/svg/person.svg" alt="About Me"/><span class="menu-option-name">About Me</span>
                
                
            </li></a>
        
            <a href="/resume/Ibrahim_Ahmed_pf_pub.pdf">
            <li class="sb-option ">
                
                    <img src="/img/LinkIcons/svg/document.svg" alt="Resume"/><span class="menu-option-name">Resume</span>
                
                
            </li></a>
        
            <a href="#noexist">
            <li class="sb-option dropdown">
                
                    <img src="/img/LinkIcons/svg/pencil.svg" alt="Posts"/><span class="menu-option-name">Posts</span>
                
                
                <div class="submenu"><ul>
                    
                        
                            <a href="/categories"><li>By Categories</li></a>
                        
                    
                        
                            <a href="/series"><li>By Series</li></a>
                        
                    
                        
                            <a href="/tags"><li>By Tags</li></a>
                        
                    
                    <a href="/post"><li>All</li></a>
                </ul></div>
                
            </li></a>
        
            <a href="/project/">
            <li class="sb-option ">
                
                    <img src="/img/LinkIcons/svg/terminal.svg" alt="Projects"/><span class="menu-option-name">Projects</span>
                
                
            </li></a>
        
    </ul>
</div>

    <div class="footer">
        <div class="copyright">© Ibrahim Ahmed</div>
    </div>
</div>
</body>
</html>

