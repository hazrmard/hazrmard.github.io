<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="/css/hugolb.css">
    <link rel="stylesheet" type="text/css" href="/css/cosmetic.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-118761164-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-118761164-1');
    </script>

    
    
    

    
    
        
        
            <script src="/js/highlight/highlight.pack.js"></script>
            <link rel="stylesheet" type="text/css" href="/css/solarized-light.css">
            <script>hljs.initHighlightingOnLoad();</script>
        
        
        
        
        
    

    
    

    <title>Optimizing static sites with hugo</title>
</head>
<body>
    
    <div class="container">

<div class="content">
    <h1 class="post-title">Optimizing static sites with hugo</h1>
    
<div class="front-matter">
    
    
        <em>Monday, Feb 6, 2017</em>
    
    
    
    <br/>Section: 
<a href="/">Home</a>



    

    
        / <a href="/post">Post</a>
    

    

    

    
    
    
        
            <br/>Categories:
                
                    <a href="/categories/developer">Developer</a>,
                
                    <a href="/categories/meta">Meta</a>,
                
        
    

    
        
            <br/>Tags:
                
                    <a href="/tags/javascript">Javascript</a>,
                
                    <a href="/tags/hugo">Hugo</a>,
                
                    <a href="/tags/web-development">Web Development</a>,
                
        
    

</div>

    
    
    <p>According to <a href="http://httparchive.org/trends.php">httparchive</a> the average size of a web page in 2016 was around 2.5MB. Now this may not seem a lot in this age where the internet is the primary media delivery platform - but it is worth noting that most web pages serve text as their primary content. Looking at the report sheds light on what constitutes an average web page:</p>
<p>The HTML content takes up around 50-60kB. Images, understandably, make up the biggest chunk with ~1.6MB. Around another ~200kB are taken up by CSS and Font files. What is surprising to me is that the next biggest chunk, at above 400kB, is JavaScript.</p>
<!-- raw HTML omitted -->
<p>The portion I want to go after is <code>JavaScript</code>. Granted that JavaScript is indispensable to web development. However in excess it can weigh everything down. Particularly in cases when it - instead of <code>CSS</code> -  is used to add responsivity to a website. In my experience <code>jQuery</code> is the biggest culprit of unnecessary bloat. But I digress.</p>
<p>While I was building this website using <a href="https://gohugo.io">Hugo</a> I realized that I would need additional JavaScript libraries for highlighting code and rendering math. And these libraries take up a ton of space. This:</p>
<ul>
<li>Increases the bandwidth cost for the user, and</li>
<li>Increases loading times which make browsing experience clunky.</li>
</ul>
<!-- raw HTML omitted -->
<p>Above is network traffic for a page on this site that uses 3rd party JS libraries to render equations. Around 200/218kB of network traffic is for that one library. This may seem a trivial amount of data but I believe that any optimization is good optimization (<em>in production especially</em>). So I harnessed all the flexibility a static site can offer. When I now build my site, only pages that render equations or contain code request external libraries. Thus different pages on my site have different - but the leanest possible - network traffic signatures.</p>
<p>How did I do it? When building sites using Hugo, for each post I can define variables that Hugo can use while rendering a page template into HTML. These variables are called <em>front matter</em> in Hugo-speak. For example, <em>front matter</em> for this page looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#960050;background-color:#1e0010">+</span>
<span style="color:#a6e22e">categories</span> = [<span style="color:#e6db74">&#34;Developer&#34;</span>, <span style="color:#e6db74">&#34;Meta&#34;</span>]
<span style="color:#a6e22e">date</span> = <span style="color:#e6db74">&#34;2017-02-03T10:07:58-06:00&#34;</span>
<span style="color:#a6e22e">hasequations</span> = <span style="color:#66d9ef">false</span>
<span style="color:#a6e22e">title</span> = <span style="color:#e6db74">&#34;Optimizing static sites with hugo&#34;</span>
<span style="color:#a6e22e">hascode</span> = <span style="color:#66d9ef">true</span>
<span style="color:#a6e22e">isexternal</span> = <span style="color:#66d9ef">false</span>
<span style="color:#a6e22e">series</span> = []
<span style="color:#a6e22e">description</span> = <span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#a6e22e">tags</span> = [<span style="color:#e6db74">&#34;Javascript&#34;</span>, <span style="color:#e6db74">&#34;Hugo&#34;</span>]
<span style="color:#a6e22e">draft</span> = <span style="color:#66d9ef">true</span>
<span style="color:#960050;background-color:#1e0010">+</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#960050;background-color:#1e0010">+</span>
</code></pre></div><p>And the <code>&lt;head&gt;</code> section for the HTML template looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-HTML" data-lang="HTML">{{if .IsPage}}
    {{if .Params.hascode}}
        &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://V_V_LONG_PATH_TO_LIBRARY/highlight.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
        &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://EVEN_LONGER_PATH.min.css&#34;</span>&gt;
        &lt;<span style="color:#f92672">script</span>&gt;<span style="color:#a6e22e">hljs</span>.<span style="color:#a6e22e">initHighlightingOnLoad</span>();&lt;/<span style="color:#f92672">script</span>&gt;
    {{end}}
    {{if .Params.hasequations}}
        &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span> <span style="color:#a6e22e">async</span>
            <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://DECENT_LENGTH_PATH/MathJax.js?config=TeX-AMS_CHTML&#34;</span>&gt;
        &lt;/<span style="color:#f92672">script</span>&gt;
    {{end}}
{{end}}
</code></pre></div><p>So now, only when I set <code>hasequations</code> to <code>true</code> does the page load <a href="https://www.mathjax.org/"><code>MathJax</code></a>. Same with <code>hascode</code> and <a href="https://highlightjs.org/"><code>Highlight.js</code></a>. This speeds up my load times and frees up the generous CDNs from unnecessary traffic. All it took was a few lines. Win-Win.</p>

    <br/>
    <div class="navigation">
    
        <a href="https://iahmed.me/post/2017-01-31-is-cold-the-new-hot/"><div class="prev nav-item">
            ← Previous Post
        </div></a>
    
    
        <a href="https://iahmed.me/post/algorithm-concepts/algorithms-balancing/"><div class="next nav-item">
            Next Post →
        </div></a>
    
</div>

    <br/>
</div>
<div class="sidebar">
    <div class="menu-icon"><h2>≡</h2></div>
    <div class="title"><h1 class="site-name">Ibrahim Ahmed</h1>
        
            <div class="sb-links">
                
                    <a href="https://www.linkedin.com/in/IbrahimAhmed1"><img src="/img/LinkIcons/svg/linkedin.svg"/></a>
                
                    <a href="https://github.com/hazrmard"><img src="/img/LinkIcons/svg/github.svg"/></a>
                
                    <a href="http://stackoverflow.com/users/4591810/hazrmard"><img src="/img/LinkIcons/svg/stackoverflow.svg"/></a>
                
            </div>
        
    </div>
    <ul class="menu-list">
        
            <a href="/">
            <li class="sb-option ">
                
                    <img src="/img/LinkIcons/svg/home.svg" alt="Home"/><span class="menu-option-name">Home</span>
                
                
            </li></a>
        
            <a href="/about/">
            <li class="sb-option ">
                
                    <img src="/img/LinkIcons/svg/person.svg" alt="About Me"/><span class="menu-option-name">About Me</span>
                
                
            </li></a>
        
            <a href="/resume/">
            <li class="sb-option ">
                
                    <img src="/img/LinkIcons/svg/document.svg" alt="Résumé"/><span class="menu-option-name">Résumé</span>
                
                
            </li></a>
        
            <a href="#noexist">
            <li class="sb-option dropdown">
                
                    <img src="/img/LinkIcons/svg/pencil.svg" alt="Posts"/><span class="menu-option-name">Posts</span>
                
                
                <div class="submenu"><ul>
                    
                        
                            <a href="/categories"><li>By Categories</li></a>
                        
                    
                        
                            <a href="/tags"><li>By Tags</li></a>
                        
                    
                    <a href="/post"><li>All</li></a>
                </ul></div>
                
            </li></a>
        
            <a href="/project/">
            <li class="sb-option ">
                
                    <img src="/img/LinkIcons/svg/terminal.svg" alt="Projects"/><span class="menu-option-name">Projects</span>
                
                
            </li></a>
        
    </ul>
</div>

    <div class="footer">
        <div class="copyright">© Ibrahim Ahmed</div>
    </div>

</div> 
</body>
</html>

